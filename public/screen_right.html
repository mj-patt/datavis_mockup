
<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html,body{margin:0;height:100%;overflow:hidden;background:#000}
    iframe{width:100%;height:100%;border:0;display:block}

    #gestureLayer{
      position:fixed;
      inset:0;
      z-index:99999;
      background:transparent;
      pointer-events:none;   /* enabled only in overview */
    }

    #flash {
      position: fixed;
      inset: 0;
      background: rgba(122,162,255,.18);
      opacity: 0;
      pointer-events: none;
      transition: opacity .12s ease;
      z-index: 100000;
    }
    #flash.on { opacity: 1; }
  </style>
</head>

<body>
  <iframe id="frame" src="overview-right.html"></iframe>
  <div id="gestureLayer"></div>
  <div id="flash"></div>

  <!-- <script>
    const MODE_KEY = "viz:mode";
    const frame = document.getElementById("frame");
    const layer = document.getElementById("gestureLayer");
    const flash = document.getElementById("flash");

    function doFlash() {
      flash.classList.add("on");
      setTimeout(() => flash.classList.remove("on"), 120);
    }

    function applyMode() {
      // DEFAULT = overview
      const mode = localStorage.getItem(MODE_KEY) || "overview";

      const target =
        mode === "controlDisplay"
          ? "control.html"
          : "overview-right.html";

      if (frame.getAttribute("src") !== target) {
        frame.setAttribute("src", target);
      }

      // Overlay only active in overview mode
      layer.style.pointerEvents =
        mode === "overview" ? "auto" : "none";
    }

    function toggleMode() {
      const mode = localStorage.getItem(MODE_KEY) || "overview";
      const next = mode === "overview" ? "controlDisplay" : "overview";

      localStorage.setItem(MODE_KEY, next);
      applyMode();
      doFlash();
    }

    // Ensure first visit always starts in overview
    if (!localStorage.getItem(MODE_KEY)) {
      localStorage.setItem(MODE_KEY, "overview");
    }

    // Desktop double click
    layer.addEventListener("dblclick", (e) => {
      e.preventDefault();
      toggleMode();
    });

    // Mobile double tap
    let lastTapTime = 0;
    let lastX = 0;
    let lastY = 0;

    layer.addEventListener("touchend", (e) => {
      const now = Date.now();
      const t = e.changedTouches && e.changedTouches[0];
      if (!t) return;

      const x = t.clientX;
      const y = t.clientY;

      const dt = now - lastTapTime;
      const dx = Math.abs(x - lastX);
      const dy = Math.abs(y - lastY);

      const isDoubleTap = dt > 0 && dt < 300 && dx < 24 && dy < 24;

      if (isDoubleTap) {
        toggleMode();
        lastTapTime = 0;
      } else {
        lastTapTime = now;
        lastX = x;
        lastY = y;
      }
    }, { passive: true });

    applyMode();

    window.addEventListener("storage", (e) => {
      if (e.key === MODE_KEY) applyMode();
    });

    window.addEventListener("focus", applyMode);
  </script> -->
  <script>
    const MODE_KEY = "viz:mode";
    const frame = document.getElementById("frame");
    const layer = document.getElementById("gestureLayer");
    const flash = document.getElementById("flash");
  
    // ALWAYS start in overview when this page loads
    localStorage.setItem(MODE_KEY, "overview");
  
    function applyMode() {
      const mode = localStorage.getItem(MODE_KEY) || "overview";
      const target = (mode === "controlDisplay") ? "control.html" : "overview-right.html";
      if (frame.getAttribute("src") !== target) frame.setAttribute("src", target);
      layer.style.pointerEvents = (mode === "overview") ? "auto" : "none";
    }
  
    function toggleMode() {
      const mode = localStorage.getItem(MODE_KEY) || "overview";
      const next = mode === "overview" ? "controlDisplay" : "overview";

      localStorage.setItem(MODE_KEY, next);
      applyMode();
      doFlash();
    }

    // Ensure first visit always starts in overview
    if (!localStorage.getItem(MODE_KEY)) {
      localStorage.setItem(MODE_KEY, "overview");
    }

    // Desktop double click
    layer.addEventListener("dblclick", (e) => {
      e.preventDefault();
      toggleMode();
    });

    // Mobile double tap
    let lastTapTime = 0;
    let lastX = 0;
    let lastY = 0;

    layer.addEventListener("touchend", (e) => {
      const now = Date.now();
      const t = e.changedTouches && e.changedTouches[0];
      if (!t) return;

      const x = t.clientX;
      const y = t.clientY;

      const dt = now - lastTapTime;
      const dx = Math.abs(x - lastX);
      const dy = Math.abs(y - lastY);

      const isDoubleTap = dt > 0 && dt < 300 && dx < 24 && dy < 24;

      if (isDoubleTap) {
        toggleMode();
        lastTapTime = 0;
      } else {
        lastTapTime = now;
        lastX = x;
        lastY = y;
      }
    }, { passive: true });

  
    applyMode();
    window.addEventListener("storage", (e) => { if (e.key === MODE_KEY) applyMode(); });
    window.addEventListener("focus", applyMode);
  </script>
  
</body>
</html>
